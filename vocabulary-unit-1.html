<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary, Unit One</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=Cqe54MX8"></script>
    <style>
/* Base Styles */
body {
    font-family: 'Poppins', sans-serif;
    background-color: #f4f4f9;
    color: #333;
    text-align: center;
    padding: 20px;
    margin: 0;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.container {
    max-width: 700px;
    margin: 40px auto;
    background-color: #ffffff;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease;
}

h1 {
    color: #5c67f2;
    font-size: 2.8rem;
    margin-bottom: 20px;
}

/* Toggle Switch Styles */
.toggle-container {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-bottom: 20px;
    gap: 10px;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.toggle-switch input {
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: background-color 0.4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: transform 0.4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #5c67f2;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

/* Dark Mode Styles */
.dark-mode {
    background-color: #1e1e2f;
    color: #d1d1e0;
}

.dark-mode .container {
    background-color: #2a2a3b;
}

.dark-mode h1 {
    color: #ffffff; /* Change <h1> color to white in dark mode */
    font-size: 2.8rem; /* Optional: Adjust font size */
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Optional: Add text shadow */
}

.dark-mode .clickable-word {
    color: #87baf3;
}

.dark-mode .answer-btn {
    background-color: #5e6bff; /* Solid color for dark mode */
    border: none; /* Removed border for consistency */
}

.dark-mode .answer-btn:hover {
    background-color: #1a23ff; /* Bigger color change on hover in dark mode */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover in dark mode */
}

.dark-mode .feedback {
    color: #87baf3;
}

.dark-mode .modal-btn {
    background-color: #87baf3;
}

/* Question Box Styles */
.question-box {
    margin: 30px 0;
    font-size: 1.8rem;
    font-weight: 600;
    color: #333;
}

.clickable-word {
    color: #5c67f2;
    cursor: pointer;
    text-decoration: underline;
    transition: color 0.3s ease;
}

.clickable-word:hover {
    color: #4a54e1;
}

/* Choices (Answer Buttons) Styles */
.choices {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 20px;
}

.answer-btn {
    padding: 15px 20px;
    font-size: 1.1rem;
    border: none;
    border-radius: 10px;
    background-color: #6b73ff; /* Solid color */
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

.answer-btn:hover {
    background-color: #2e3bff; /* Bigger color change on hover */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
}

/* Dark Mode Hover Effect */
.dark-mode .answer-btn:hover {
    background-color: #1a23ff; /* Bigger color change on hover in dark mode */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover in dark mode */
}

/* Feedback Styles */
.feedback {
    font-size: 1.3rem;
    margin-top: 30px;
    color: #5c67f2;
    height: 40px; /* Fixed height */
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.3s ease;
}

/* Progress Bar Styles */
.progress-bar {
    width: 100%;
    background-color: #ddd;
    height: 20px;
    border-radius: 10px;
    margin-top: 30px;
    overflow: hidden;
}

.progress {
    background-color: #5c67f2;
    height: 100%;
    border-radius: 10px;
    width: 0%; /* Start at 0% */
    transition: width 0.4s ease;
}

/* Counters and Protocol Styles */
.protocol, .counters {
    margin-top: 30px;
    font-size: 1.2rem;
    text-align: left;
}

.protocol p, .counters p {
    margin-bottom: 10px;
}

/* Fixed height for Missed Words List */
#missed-words-list {
    height: 60px; /* Adjust as needed */
    overflow-y: auto;
    margin: 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background-color: #f9f9f9;
}

.protocol ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

.protocol ul li {
    display: inline-block;
    margin-right: 10px;
    padding: 5px 10px;
    background-color: #ff4d4d;
    color: white;
    border-radius: 20px;
    font-weight: bold;
}

/* Modal Styling */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    transition: opacity 0.3s ease;
}

.modal-content {
    background-color: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    max-width: 500px;
    width: 90%;
    box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
}

.modal-buttons {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    gap: 20px;
}

.modal-btn {
    padding: 12px 25px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #5c67f2;
    color: white;
    transition: background-color 0.3s ease;
}

.modal-btn:hover {
    background-color: #4557f0;
}

/* Reset Button Styles */
.reset-btn {
    margin-top: 20px;
    padding: 12px 25px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #ff4d4d;
    color: white;
    transition: background-color 0.3s ease;
}

.reset-btn:hover {
    background-color: #e04343;
}

/* Mode Label Styles */
#modeLabel {
    font-size: 1rem;
    color: #333;
    transition: color 0.3s ease;
}

.dark-mode #modeLabel {
    color: #d1d1e0;
}

/* Responsive Design */
@media (max-width: 600px) {
    .choices {
        grid-template-columns: 1fr;
    }

    .protocol, .counters {
        font-size: 1rem;
    }

    .modal-content {
        padding: 20px;
    }

    .modal-btn, .reset-btn {
        padding: 10px 20px;
        font-size: 0.9rem;
    }

    #modeLabel {
        font-size: 0.9rem;
    }
}
    </style>
</head>
<body>
    <div class="toggle-container">
        <span id="modeLabel">Dark mode</span>
        <label class="toggle-switch">
            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
            <span class="slider"></span>
        </label>
    </div>

    <div class="container">
        <h1>Vocabulary – Unit One</h1>
        <div class="progress-bar">
            <div id="progress" class="progress"></div>
        </div>
        <div class="question-box">
            <p id="swedish-word" class="clickable-word" onclick="speakSwedish()"></p>
        </div>
        <div class="choices">
            <button class="answer-btn" onclick="checkAnswer(0)" id="choice0"></button>
            <button class="answer-btn" onclick="checkAnswer(1)" id="choice1"></button>
            <button class="answer-btn" onclick="checkAnswer(2)" id="choice2"></button>
            <button class="answer-btn" onclick="checkAnswer(3)" id="choice3"></button>
        </div>
        <div class="feedback" id="feedback"></div>

        <div class="counters">
            <p>Correct Answers: <span id="correct-counter">0</span></p>
            <p>Mistakes: <span id="mistake-counter">0</span></p>
        </div>

        <div class="protocol">
            <p><strong>Words Missed on First Try:</strong></p>
            <ul id="missed-words-list"></ul>
        </div>

        <!-- Reset Button -->
        <button class="reset-btn" onclick="resetPage()">Reset</button>
    </div>

    <!-- Modal for Missed Words -->
    <div id="missedModal" class="modal">
        <div class="modal-content">
            <p id="modal-message">You missed some words on the first try. Do you want to have another go?</p>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="retryMissed()">Yes</button>
                <button class="modal-btn" onclick="closeModal()">No</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Variables
        let currentQuestion = 0;
        let correctAnswers = 0;
        let mistakes = 0;
        let missedWords = [];
        const vocabulary = [
            { swedish: "hej", english: ["hello", "goodbye", "evening", "thanks"], correct: 0 },
{ swedish: "jag", english: ["I", "you", "she", "they"], correct: 0 },
{ swedish: "att heta", english: ["to be called", "to run", "to jump", "to sing"], correct: 0 },
{ swedish: "jag heter", english: ["my name is", "I live", "I like", "I sing"], correct: 0 },
{ swedish: "nitton", english: ["nineteen", "sixteen", "twenty-one", "thirty"], correct: 0 },
{ swedish: "år", english: ["years", "days", "hours", "minutes"], correct: 0 },
{ swedish: "att komma", english: ["to come", "to leave", "to cry", "to laugh"], correct: 0 },
{ swedish: "jag kommer från", english: ["I come from", "I go to", "I live with", "I leave from"], correct: 0 },
{ swedish: "att studera", english: ["to study", "to teach", "to cook", "to drive"], correct: 0 },
{ swedish: "svenska", english: ["Swedish", "Norwegian", "English", "German"], correct: 0 },
{ swedish: "pojkvän", english: ["boyfriend", "girlfriend", "mother", "teacher"], correct: 0 },
{ swedish: "jag kallas för", english: ["I am called", "I am walking", "I am working", "I am eating"], correct: 0 },
{ swedish: "svensk", english: ["Swedish", "French", "Italian", "Russian"], correct: 0 },
{ swedish: "datavetenskap", english: ["computer science", "physics", "biology", "history"], correct: 0 },
{ swedish: "på", english: ["at, on", "under", "beside", "behind"], correct: 0 },
{ swedish: "universitet", english: ["university", "school", "hospital", "library"], correct: 0 },
{ swedish: "universitetet", english: ["the university", "the restaurant", "the museum", "the airport"], correct: 0 },
{ swedish: "det här", english: ["this", "that", "those", "these"], correct: 0 },
{ swedish: "min / mitt", english: ["my", "your", "his", "their"], correct: 0 },
{ swedish: "mamma", english: ["mum", "dad", "brother", "teacher"], correct: 0 },
{ swedish: "och", english: ["and", "or", "but", "because"], correct: 0 },
{ swedish: "pappa", english: ["dad", "mum", "sister", "teacher"], correct: 0 },
{ swedish: "syster", english: ["sister", "brother", "cousin", "mother"], correct: 0 },
{ swedish: "det", english: ["it", "she", "him", "they"], correct: 0 },
{ swedish: "att vara", english: ["to be", "to eat", "to walk", "to read"], correct: 0 },
{ swedish: "jag är", english: ["I am", "I run", "I drink", "I sleep"], correct: 0 },
{ swedish: "i", english: ["in", "on", "over", "under"], correct: 0 },
{ swedish: "Skottland", english: ["Scotland", "Ireland", "Wales", "France"], correct: 0 },
{ swedish: "musiker", english: ["musician", "actor", "dancer", "writer"], correct: 0 },
{ swedish: "att spela", english: ["to play", "to sing", "to write", "to cook"], correct: 0 },
{ swedish: "jag spelar", english: ["I play", "I sing", "I read", "I walk"], correct: 0 },
{ swedish: "fiol", english: ["violin", "guitar", "piano", "trumpet"], correct: 0 },
{ swedish: "barndomsvän", english: ["childhood friend", "cousin", "teacher", "neighbour"], correct: 0 },
{ swedish: "med", english: ["with", "under", "over", "behind"], correct: 0 },
{ swedish: "att vilja", english: ["to want", "to need", "to have", "to like"], correct: 0 },
{ swedish: "jag vill", english: ["I want", "I need", "I see", "I speak"], correct: 0 },
{ swedish: "att ha", english: ["to have", "to walk", "to speak", "to learn"], correct: 0 },
{ swedish: "jag har", english: ["I have", "I do", "I see", "I know"], correct: 0 },
{ swedish: "kopp", english: ["cup", "plate", "fork", "knife"], correct: 0 },
{ swedish: "kaffe", english: ["coffee", "tea", "juice", "water"], correct: 0 },
{ swedish: "bulle", english: ["bun", "cake", "sandwich", "ice cream"], correct: 0 },
{ swedish: "nej", english: ["no", "yes", "maybe", "thanks"], correct: 0 },
{ swedish: "tack", english: ["thank you", "goodbye", "hello", "maybe"], correct: 0 },
{ swedish: "vill ha", english: ["want", "give", "take", "know"], correct: 0 },
{ swedish: "jag vill ha", english: ["I want", "I give", "I take", "I know"], correct: 0 },
{ swedish: "smörgås", english: ["sandwich", "pizza", "soup", "drink"], correct: 0 },
{ swedish: "hungrig", english: ["hungry", "tired", "happy", "cold"], correct: 0 },
{ swedish: "skinksmörgås", english: ["ham sandwich", "cheese sandwich", "salad", "soup"], correct: 0 },
{ swedish: "tyvärr", english: ["unfortunately", "certainly", "happily", "immediately"], correct: 0 },
{ swedish: "slut", english: ["out of", "ready", "full", "big"], correct: 0 },
{ swedish: "ostsmörgås", english: ["cheese sandwich", "ham sandwich", "soup", "salad"], correct: 0 },
{ swedish: "då", english: ["then", "now", "here", "there"], correct: 0 },
{ swedish: "att ta", english: ["to take", "to give", "to leave", "to walk"], correct: 0 },
{ swedish: "jag tar", english: ["I take", "I give", "I see", "I speak"], correct: 0 },
{ swedish: "te", english: ["tea", "coffee", "water", "milk"], correct: 0 },
{ swedish: "apelsinjuice", english: ["orange juice", "apple juice", "milk", "soda"], correct: 0 },
{ swedish: "javisst", english: ["certainly", "unfortunately", "maybe", "never"], correct: 0 },
{ swedish: "kan jag få", english: ["may I have", "will I give", "should I go", "can I see"], correct: 0 },
{ swedish: "att kunna", english: ["to be able to (can)", "to want", "to have", "to see"], correct: 0 },
{ swedish: "jag kan", english: ["I can", "I need", "I give", "I take"], correct: 0 },
{ swedish: "kanelbulle", english: ["cinnamon bun", "sandwich", "pizza", "ice cream"], correct: 0 },
{ swedish: "att bli", english: ["to become", "to run", "to eat", "to drink"], correct: 0 },
{ swedish: "det blir", english: ["it becomes", "it takes", "it needs", "it gives"], correct: 0 },
{ swedish: "åttio", english: ["eighty", "fifty", "thirty", "hundred"], correct: 0 },
{ swedish: "krona", english: ["crown (currency)", "dollar", "euro", "pound"], correct: 0 },
{ swedish: "åttio kronor", english: ["eighty crowns", "thirty pounds", "ten euros", "fifty dollars"], correct: 0 },
{ swedish: "varsågod", english: ["you're welcome", "goodbye", "thanks", "sorry"], correct: 0 },
{ swedish: "tack så mycket", english: ["thank you very much", "goodbye", "yes please", "sorry"], correct: 0 },
{ swedish: "att omfatta", english: ["to include, comprise", "to run", "to eat", "to work"], correct: 0 },
{ swedish: "att tala", english: ["to speak", "to run", "to sleep", "to walk"], correct: 0 },
{ swedish: "jag talar", english: ["I speak", "I run", "I eat", "I know"], correct: 0 },
{ swedish: "mest", english: ["mostly", "sometimes", "rarely", "never"], correct: 0 },
{ swedish: "engelska", english: ["English", "French", "Spanish", "Italian"], correct: 0 },
{ swedish: "drottning", english: ["queen", "king", "princess", "prime minister"], correct: 0 },
{ swedish: "huvudstad", english: ["capital city", "small town", "village", "country"], correct: 0 },
{ swedish: "kung", english: ["king", "queen", "prince", "emperor"], correct: 0 },
{ swedish: "industriland", english: ["industrial country", "desert", "forest", "island"], correct: 0 },
{ swedish: "mycket", english: ["a lot, much", "a little", "never", "sometimes"], correct: 0 },
{ swedish: "skog", english: ["forest", "river", "mountain", "city"], correct: 0 },
{ swedish: "ganska", english: ["quite", "never", "rarely", "often"], correct: 0 },
{ swedish: "sällan", english: ["rarely", "always", "often", "never"], correct: 0 },
{ swedish: "sol", english: ["sun", "moon", "star", "sky"], correct: 0 },
{ swedish: "regn", english: ["rain", "sun", "wind", "fog"], correct: 0 },
{ swedish: "ibland", english: ["sometimes", "never", "always", "rarely"], correct: 0 },
{ swedish: "både … och …", english: ["both … and …", "neither … nor …", "either … or …", "only … not …"], correct: 0 },

        ];
        let isRetry = false;

        // New Variables for Progress Tracking
        let totalQuestions = 0;
        let answeredQuestions = 0;

        // Variable to track the correct answer index after shuffling
        let currentCorrectIndex = 0;

        // Function to shuffle an array (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to render the missed words list in the DOM
        function renderMissedWordsList() {
            const missedList = document.getElementById("missed-words-list");
            missedList.innerHTML = ""; // Clear existing list

            missedWords.forEach(word => {
                const missedWordItem = document.createElement("li");
                missedWordItem.innerText = word.swedish;
                missedList.appendChild(missedWordItem);
            });
        }

        // Reset missed words for the current set
        function startNewSet() {
            if (!isRetry) {
                missedWords = []; // Reset missed words for the main set only
            }
            renderMissedWordsList(); // Clear or update UI list based on missedWords

            // Determine the current word list based on retry status
            const wordList = isRetry ? missedWords : vocabulary;
            totalQuestions = wordList.length;
            answeredQuestions = 0;
            document.getElementById("progress").style.width = "0%";

            // Reset counters only when starting the main set
            if (!isRetry) {
                correctAnswers = 0;
                mistakes = 0;
                document.getElementById("correct-counter").innerText = "0";
                document.getElementById("mistake-counter").innerText = "0";
            }

            console.log(`Starting new set. isRetry: ${isRetry}, totalQuestions: ${totalQuestions}`);
        }

        // Load a question
        function loadQuestion() {
            const wordList = isRetry ? missedWords : vocabulary;

            console.log(`Loading question. CurrentQuestion: ${currentQuestion}, WordList Length: ${wordList.length}`);

            if (currentQuestion >= wordList.length) {
                // All questions have been answered
                if (missedWords.length === 0) {
                    // All answers were correct, show the completion feedback
                    document.getElementById("feedback").innerText = "You've completed the quiz!";
                    isRetry = false;  // Reset retry flag
                    document.getElementById("missedModal").style.display = "none"; // Ensure modal doesn't show
                    console.log("Quiz completed without any missed words.");
                } else {
                    // Only trigger modal if there are missed words
                    showModal();  
                    console.log(`Quiz completed with ${missedWords.length} missed words.`);
                }
                return;
            }

            const currentWord = wordList[currentQuestion];
            document.getElementById("swedish-word").innerText = currentWord.swedish;

            // Shuffle the answer choices
            let shuffledChoices = [...currentWord.english];
            shuffledChoices = shuffleArray(shuffledChoices);

            // Determine the new index of the correct answer after shuffling
            const correctAnswerText = currentWord.english[currentWord.correct];
            currentCorrectIndex = shuffledChoices.indexOf(correctAnswerText);

            // Assign shuffled choices to buttons
            for (let i = 0; i < 4; i++) {
                document.getElementById(`choice${i}`).innerText = shuffledChoices[i];
            }

            document.getElementById("feedback").innerText = "";

            console.log(`Loaded word: ${currentWord.swedish}`);
            console.log(`Shuffled choices: ${shuffledChoices}`);
            console.log(`Correct answer is at index: ${currentCorrectIndex}`);
        }

        // Speak the Swedish word
        function speakSwedish() {
            const wordList = isRetry ? missedWords : vocabulary;
            if (currentQuestion >= wordList.length) {
                console.log(`Attempted to speak word, but currentQuestion (${currentQuestion}) is out of bounds.`);
                return;
            }
            const swedishWord = wordList[currentQuestion].swedish;
            console.log(`Speaking word: ${swedishWord}`);
            responsiveVoice.speak(swedishWord, 'Swedish Female');
        }

        // Function to update the progress bar
        function updateProgressBar() {
            if (totalQuestions === 0) return; // Prevent division by zero
            const progress = (answeredQuestions / totalQuestions) * 100;
            document.getElementById("progress").style.width = `${progress}%`;
            console.log(`Progress updated: ${answeredQuestions}/${totalQuestions} (${progress}%)`);
        }

        // Check the user's answer
        function checkAnswer(choice) {
            const wordList = isRetry ? missedWords : vocabulary;
            if (currentQuestion >= wordList.length) {
                console.log(`Attempted to check answer, but currentQuestion (${currentQuestion}) is out of bounds.`);
                return;
            }
            const currentWord = wordList[currentQuestion];
            const isCorrect = choice === currentCorrectIndex;

            console.log(`User selected choice ${choice} for word "${currentWord.swedish}". Correct answer index: ${currentCorrectIndex}. Is correct: ${isCorrect}`);

            if (isCorrect) {
                document.getElementById("feedback").innerText = "Correct!";
                correctAnswers++;
                document.getElementById("correct-counter").innerText = correctAnswers;
                console.log(`Correct answer. Total correctAnswers: ${correctAnswers}`);

                if (isRetry) {
                    // Remove the word from missedWords if answered correctly during retry
                    missedWords.splice(currentQuestion, 1);
                    renderMissedWordsList(); // Update the DOM list
                    console.log(`Removed word "${currentWord.swedish}" from missedWords.`);

                    // Increment answeredQuestions and update progress bar
                    answeredQuestions++;
                    updateProgressBar();

                    // Do not increment currentQuestion because the array has shifted
                } else {
                    // Increment answeredQuestions and update progress bar for main set
                    answeredQuestions++;
                    updateProgressBar();
                    currentQuestion++;
                }
            } else {
                document.getElementById("feedback").innerText = "Wrong answer!";
                console.log(`Incorrect answer for word "${currentWord.swedish}".`);

                // Add missed word to missedWords array if not already there
                if (!missedWords.some(word => word.swedish === currentWord.swedish)) {
                    missedWords.push(currentWord);
                    mistakes++;
                    document.getElementById("mistake-counter").innerText = mistakes;
                    renderMissedWordsList(); // Update the DOM list
                    console.log(`Added word "${currentWord.swedish}" to missedWords. Total mistakes: ${mistakes}`);
                } else {
                    console.log(`Word "${currentWord.swedish}" is already in missedWords. Mistakes not incremented.`);
                }

                // Increment answeredQuestions and update progress bar
                answeredQuestions++;
                updateProgressBar();

                currentQuestion++;
            }

            document.getElementById("feedback").classList.add("show-feedback");

            // Delay before loading the next question (Reduced from 1.5s to 0.5s)
            setTimeout(() => {
                loadQuestion();
                document.getElementById("feedback").classList.remove("show-feedback");
            }, 500); // Load next question after 0.5 seconds
        }

        // Show the modal if there are missed words
        function showModal() {
            const modalMessage = document.getElementById("modal-message");
            if (missedWords.length === 1) {
                modalMessage.innerHTML = `You got "${missedWords[0].swedish}" wrong. Do you want to try it again?`;
            } else if (missedWords.length > 1) {
                modalMessage.innerHTML = `You made ${mistakes} mistake${mistakes > 1 ? 's' : ''}. Do you want to try those words again?`;
            }
            document.getElementById("missedModal").style.display = "flex";

            console.log(`Modal displayed. MissedWords: ${missedWords.length}, Mistakes: ${mistakes}`);
        }

        // Close the modal
        function closeModal() {
            document.getElementById("missedModal").style.display = "none";
            console.log("Modal closed.");
        }

        // Retry with missed words
        function retryMissed() {
            if (missedWords.length === 0) {
                // No missed words to retry
                document.getElementById("feedback").innerText = "Great job! No words to retry.";
                closeModal();
                console.log("No missed words to retry.");
                return;
            }

            isRetry = true;
            currentQuestion = 0;
            answeredQuestions = 0;
            totalQuestions = missedWords.length;
            mistakes = 0; // Reset mistakes counter for the new set
            document.getElementById("mistake-counter").innerText = mistakes;
            document.getElementById("progress").style.width = "0%";
            document.getElementById("correct-counter").innerText = "0";
            correctAnswers = 0;
            console.log(`Retrying missed words. TotalQuestions: ${totalQuestions}`);

            closeModal(); // Close the modal
            loadQuestion(); // Load the first missed word
        }

        // Reset the quiz by refreshing the page
        function resetPage() {
            location.reload();
        }

        // Toggle dark mode and update the mode label
        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            const modeLabel = document.getElementById("modeLabel");
            if (document.body.classList.contains("dark-mode")) {
                modeLabel.innerText = "Dark mode";
            } else {
                modeLabel.innerText = "Dark mode";
            }
            console.log("Dark mode toggled.");
        }

        // Initialize the quiz and start a new set
        window.onload = function() {
            document.getElementById("missedModal").style.display = "none"; // Ensure modal is hidden on load
            startNewSet(); // Reset missed words for the first set
            loadQuestion();  // Load the first question
            console.log("Quiz initialized.");
        };
    </script>
</body>
</html>
