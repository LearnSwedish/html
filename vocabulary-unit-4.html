
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Four: all</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=Cqe54MX8"></script>
    <style>
/* Base Styles */
body {
    font-family: 'Poppins', sans-serif;
    background-color: #f4f4f9;
    color: #333;
    text-align: center;
    padding: 20px;
    margin: 0;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.container {
    max-width: 700px;
    margin: 10px auto;
    background-color: #ffffff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease;
}

h1 {
    color: #5c67f2;
    font-size: 2.8rem;
    margin-bottom: 20px;
}

/* Toggle Switch Styles */
.toggle-container {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    margin-bottom: 20px;
    gap: 10px;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.toggle-switch input {
    display: none;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: background-color 0.4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: transform 0.4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #5c67f2;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

/* Dark Mode Styles */
.dark-mode {
    background-color: #1e1e2f;
    color: #d1d1e0;
}

.dark-mode .container {
    background-color: #2a2a3b;
}

.dark-mode h1 {
    color: #ffffff; /* Change <h1> color to white in dark mode */
    font-size: 2.8rem; /* Optional: Adjust font size */
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Optional: Add text shadow */
}

.dark-mode .clickable-word {
    color: #87baf3;
}

.dark-mode .answer-btn {
    background-color: #5e6bff; /* Solid color for dark mode */
    border: none; /* Removed border for consistency */
}

.dark-mode .answer-btn:hover {
    background-color: #1a23ff; /* Bigger color change on hover in dark mode */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover in dark mode */
}

.dark-mode .feedback {
    color: #87baf3;
}

.dark-mode .modal-btn {
    background-color: #87baf3;
}

.dark-mode .modal-content {
    color: #000; /* Set the text color to black */
}

/* Question Box Styles */
.question-box {
    margin: 30px 0;
    font-size: 1.8rem;
    font-weight: 600;
    color: #333;
}

.clickable-word {
    color: #5c67f2;
    cursor: pointer;
    text-decoration: underline;
    transition: color 0.3s ease;
}

.clickable-word:hover {
    color: #4a54e1;
}

/* Choices (Answer Buttons) Styles */
.choices {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 20px;
}

.answer-btn {
    padding: 15px 20px;
    font-size: 1.1rem;
    border: none;
    border-radius: 10px;
    background-color: #6b73ff; /* Solid color */
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

.answer-btn:hover {
    background-color: #2e3bff; /* Bigger color change on hover */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); /* Enhanced shadow on hover */
}

/* Dark Mode Hover Effect */
.dark-mode .answer-btn:hover {
    background-color: #1a23ff; /* Bigger color change on hover in dark mode */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover in dark mode */
}

/* Feedback Styles */
.feedback {
    font-size: 1.3rem;
    margin-top: 30px;
    color: #5c67f2;
    height: 40px; /* Fixed height */
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.3s ease;
}

/* Progress Bar Styles */
.progress-bar {
    width: 100%;
    background-color: #ddd;
    height: 20px;
    border-radius: 10px;
    margin-top: 30px;
    overflow: hidden;
}

.progress {
    background-color: #5c67f2;
    height: 100%;
    border-radius: 10px;
    width: 0%; /* Start at 0% */
    transition: width 0.4s ease;
}

/* Counters and Protocol Styles */
.protocol, .counters {
    margin-top: 30px;
    font-size: 1.2rem;
    text-align: left;
}

.protocol p, .counters p {
    margin-bottom: 10px;
}

/* Fixed height for Missed Words List */
#missed-words-list {
    height: 60px; /* Adjust as needed */
    overflow-y: auto;
    margin: 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background-color: #f9f9f9;
    font-size: 0.8rem; /* Adjust the font size to make words smaller */
}
.protocol ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

.protocol ul li {
    display: inline-block;
    margin-right: 10px;
    padding: 5px 10px;
    background-color: #ff4d4d;
    color: white;
    border-radius: 20px;
    font-weight: bold;
}

/* Modal Styling */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    transition: opacity 0.3s ease;
}

.modal-content {
    background-color: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    max-width: 500px;
    width: 90%;
    box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
}

.modal-buttons {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    gap: 20px;
}

.modal-btn {
    padding: 12px 25px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #5c67f2;
    color: white;
    transition: background-color 0.3s ease;
}

.modal-btn:hover {
    background-color: #4557f0;
}

/* Reset Button Styles */
.reset-btn {
    margin-top: 20px;
    padding: 12px 25px;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #ff4d4d;
    color: white;
    transition: background-color 0.3s ease;
}

.reset-btn:hover {
    background-color: #e04343;
}

/* Mode Label Styles */
#modeLabel {
    font-size: 1rem;
    color: #333;
    transition: color 0.3s ease;
}

.dark-mode #modeLabel {
    color: #d1d1e0;
}

/* Responsive Design */
@media (max-width: 600px) {
    .choices {
        grid-template-columns: 1fr;
    }

    .protocol, .counters {
        font-size: 1rem;
    }

    .modal-content {
        padding: 20px;
    }

    .modal-btn, .reset-btn {
        padding: 10px 20px;
        font-size: 0.9rem;
    }

    #modeLabel {
        font-size: 0.9rem;
    }
}
    </style>
</head>
<body>
    <div class="toggle-container">
        <span id="modeLabel">Dark mode</span>
        <label class="toggle-switch">
            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
            <span class="slider"></span>
        </label>
    </div>

    <div class="container">
        <h1>Unit Four: all</h1>
        <div class="progress-bar">
            <div id="progress" class="progress"></div>
        </div>
        <div class="question-box">
            <p id="swedish-word" class="clickable-word" onclick="speakSwedish()"></p>
        </div>
        <div class="choices">
            <button class="answer-btn" onclick="checkAnswer(0)" id="choice0"></button>
            <button class="answer-btn" onclick="checkAnswer(1)" id="choice1"></button>
            <button class="answer-btn" onclick="checkAnswer(2)" id="choice2"></button>
            <button class="answer-btn" onclick="checkAnswer(3)" id="choice3"></button>
        </div>
        <div class="feedback" id="feedback"></div>

        <div class="counters">
            <p>Correct Answers: <span id="correct-counter">0</span></p>
            <p>Mistakes: <span id="mistake-counter">0</span></p>
        </div>

        <div class="protocol">
            <p><strong>Words missed on first try:</strong></p>
            <ul id="missed-words-list"></ul>
        </div>

        <!-- Reset Button -->
        <button class="reset-btn" onclick="resetPage()">Reset</button>
    </div>

    <!-- Modal for Missed Words -->
    <div id="missedModal" class="modal">
        <div class="modal-content">
            <p id="modal-message">You missed some words on the first try. Do you want to have another go?</p>
            <div class="modal-buttons">
                <button class="modal-btn" onclick="retryMissed()">Yes</button>
                <button class="modal-btn" onclick="closeModal()">No</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Variables
        let currentQuestion = 0;
        let correctAnswers = 0;
        let mistakes = 0;
        let missedWords = [];
        let previousRoundMissedWords = []; // New variable to track missed words across rounds
        const vocabulary = [
{ swedish: "år", english: ["year", "day", "month", "hour"], correct: 0 },
{ swedish: "juli", english: ["July", "June", "August", "May"], correct: 0 },
{ swedish: "brukar", english: ["usually", "rarely", "never", "occasionally"], correct: 0 },
{ swedish: "familj", english: ["family", "neighbor", "friend", "colleague"], correct: 0 },
{ swedish: "semester", english: ["holiday", "work", "weekend", "routine"], correct: 0 },
{ swedish: "undantag", english: ["exception", "rule", "habit", "tradition"], correct: 0 },
{ swedish: "det enda", english: ["the only thing", "the best", "everything", "nothing"], correct: 0 },
{ swedish: "annorlunda", english: ["different", "similar", "identical", "familiar"], correct: 0 },
{ swedish: "inte är med", english: ["is not with", "is with", "is alongside", "is around"], correct: 0 },
{ swedish: "att sommarjobba", english: ["to have a summer job", "to have a hobby", "to have a job", "to have a holiday"], correct: 0 },
{ swedish: "dataföretag", english: ["computer company", "bank", "university", "hospital"], correct: 0 },
{ swedish: "är på väg", english: ["be on their way", "be staying", "be returning", "be leaving"], correct: 0 },
{ swedish: "del", english: ["part", "whole", "item", "unit"], correct: 0 },
{ swedish: "Danmark", english: ["Denmark", "Norway", "Sweden", "Finland"], correct: 0 },
{ swedish: "för... sedan", english: ["ago", "later", "tomorrow", "soon"], correct: 0 },
{ swedish: "att tycka", english: ["to think, to consider", "to ignore", "to forget", "to overlook"], correct: 0 },
{ swedish: "svår, svårt", english: ["difficult", "easy", "simple", "obvious"], correct: 0 },
{ swedish: "ibland", english: ["sometimes", "always", "never", "often"], correct: 0 },
{ swedish: "att förstå", english: ["to understand", "to confuse", "to misunderstand", "to overlook"], correct: 0 },
{ swedish: "skånska", english: ["dialect spoken in Skåne", "language", "slang", "accent"], correct: 0 },
{ swedish: "dialekt", english: ["dialect", "language", "alphabet", "vocabulary"], correct: 0 },
{ swedish: "att tala", english: ["to speak", "to write", "to read", "to listen"], correct: 0 },
{ swedish: "bilresa", english: ["car journey", "train ride", "flight", "walk"], correct: 0 },
{ swedish: "varm, varmt", english: ["hot", "cold", "warm", "cool"], correct: 0 },
{ swedish: "att lyssna", english: ["to listen", "to ignore", "to speak", "to write"], correct: 0 },
{ swedish: "musik", english: ["music", "noise", "sound", "silence"], correct: 0 },
{ swedish: "radio", english: ["radio", "television", "newspaper", "phone"], correct: 0 },
{ swedish: "att tycka om", english: ["to like", "to hate", "to dislike", "to reject"], correct: 0 },
{ swedish: "skånsk, skånskt", english: ["of Skåne", "of Stockholm", "of Gothenburg", "of Malmö"], correct: 0 },
{ swedish: "slätt", english: ["plain", "mountain", "valley", "forest"], correct: 0 },
{ swedish: "tyst", english: ["silent, quiet", "noisy", "loud", "chatty"], correct: 0 },
{ swedish: "att njuta", english: ["to enjoy", "to despise", "to dislike", "to hate"], correct: 0 },
{ swedish: "utsikt", english: ["view", "sound", "smell", "touch"], correct: 0 },
{ swedish: "över", english: ["across", "under", "next to", "along"], correct: 0 },
{ swedish: "snart", english: ["soon", "later", "never", "now"], correct: 0 },
{ swedish: "framme vid", english: ["reach", "leave", "avoid", "bypass"], correct: 0 },
{ swedish: "kust", english: ["coast", "island", "mountain", "river"], correct: 0 },
{ swedish: "att stanna", english: ["to stop", "to go", "to run", "to walk"], correct: 0 },
{ swedish: "att bada", english: ["to have a swim", "to hike", "to cycle", "to drive"], correct: 0 },
{ swedish: "promenad", english: ["walk", "run", "jump", "drive"], correct: 0 },
{ swedish: "att titta", english: ["to look", "to ignore", "to avoid", "to listen"], correct: 0 },
{ swedish: "gammal, gammalt", english: ["old", "young", "new", "fresh"], correct: 0 },
{ swedish: "slott", english: ["castle", "house", "building", "tent"], correct: 0 },
{ swedish: "istället", english: ["instead", "because", "before", "during"], correct: 0 },
{ swedish: "när", english: ["when", "where", "how", "why"], correct: 0 },
{ swedish: "lunchdags", english: ["lunchtime", "breakfast", "dinner", "supper"], correct: 0 },
{ swedish: "att äta", english: ["to eat", "to drink", "to sleep", "to talk"], correct: 0 },
{ swedish: "gästgiveri", english: ["country inn", "hotel", "restaurant", "bar"], correct: 0 },
{ swedish: "smörgåsbord", english: ["smorgasbord", "buffet", "cafe", "bakery"], correct: 0 },
{ swedish: "fiskrestaurang", english: ["fish restaurant", "seafood market", "grocery store", "café"], correct: 0 },
{ swedish: "att vilja ha", english: ["to want", "to give", "to take", "to offer"], correct: 0 },
{ swedish: "hamburgare", english: ["hamburger", "sandwich", "pizza", "hotdog"], correct: 0 },
{ swedish: "den här", english: ["this", "that", "these", "those"], correct: 0 },
{ swedish: "gång (den här gången)", english: ["time (this time)", "date", "event", "place"], correct: 0 },
{ swedish: "efter", english: ["after", "before", "during", "while"], correct: 0 },
{ swedish: "mat", english: ["food, here: meal", "drink", "dessert", "snack"], correct: 0 },
{ swedish: "resa (åka) vidare", english: ["continue one's journey", "return", "stop", "pause"], correct: 0 },
{ swedish: "västra", english: ["western", "eastern", "southern", "northern"], correct: 0 },
{ swedish: "vacker, vackert", english: ["beautiful", "ugly", "plain", "ordinary"], correct: 0 },
{ swedish: "universitetsstad", english: ["university town", "city", "village", "school"], correct: 0 },
{ swedish: "mer", english: ["more", "less", "none", "fewer"], correct: 0 },
{ swedish: "kultur", english: ["culture", "nature", "sport", "technology"], correct: 0 },
{ swedish: "domkyrka", english: ["cathedral", "chapel", "mosque", "temple"], correct: 0 },
{ swedish: "post(kontor)", english: ["post office", "bank", "library", "market"], correct: 0 },
{ swedish: "att skicka", english: ["to send", "to receive", "to take", "to collect"], correct: 0 },
{ swedish: "vykort", english: ["postcard", "letter", "package", "email"], correct: 0 },
{ swedish: "jobb", english: ["work, job", "hobby", "game", "holiday"], correct: 0 },
{ swedish: "medan", english: ["while", "after", "before", "since"], correct: 0 },
{ swedish: "att köpa", english: ["to buy", "to sell", "to borrow", "to lend"], correct: 0 },
{ swedish: "ny, nytt", english: ["new", "old", "used", "ancient"], correct: 0 },
{ swedish: "sko", english: ["shoe", "hat", "glove", "jacket"], correct: 0 },
{ swedish: "alla", english: ["everyone", "someone", "nobody", "some"], correct: 0 },
{ swedish: "samma", english: ["the same", "different", "unique", "various"], correct: 0 },
{ swedish: "sak", english: ["thing", "person", "place", "event"], correct: 0 },
{ swedish: "hotell", english: ["hotel", "house", "apartment", "inn"], correct: 0 },
{ swedish: "att sova", english: ["to sleep", "to wake up", "to eat", "to work"], correct: 0 },
{ swedish: "att ropa", english: ["to shout, to call", "to whisper", "to sing", "to listen"], correct: 0 },
{ swedish: "möjligen", english: ["possibly", "certainly", "always", "rarely"], correct: 0 },
{ swedish: "tid", english: ["time", "date", "moment", "second"], correct: 0 },
{ swedish: "att hitta", english: ["to find", "to lose", "to search", "to give"], correct: 0 },
{ swedish: "bra", english: ["good", "bad", "average", "worse"], correct: 0 },
{ swedish: "internetsida", english: ["webpage", "application", "document", "software"], correct: 0 },
{ swedish: "sekund", english: ["second", "minute", "hour", "day"], correct: 0 },
{ swedish: "se ut (som…)", english: ["look (like), appear to be", "disappear", "avoid", "ignore"], correct: 0 },
{ swedish: "verkligen", english: ["really", "somewhat", "barely", "rarely"], correct: 0 },
{ swedish: "dyr, dyrt", english: ["expensive", "cheap", "affordable", "free"], correct: 0 },
{ swedish: "prisvärd, prisvärt", english: ["good value", "worthless", "costly", "useless"], correct: 0 },
{ swedish: "dubbelrum", english: ["double room", "single room", "suite", "hall"], correct: 0 },
{ swedish: "till", english: ["to, for", "against", "inside", "under"], correct: 0 },
{ swedish: "enkelrum", english: ["single room", "double room", "dormitory", "suite"], correct: 0 },
{ swedish: "att fylla i", english: ["to fill in, to complete", "to empty", "to erase", "to leave"], correct: 0 },
{ swedish: "datum", english: ["date", "event", "time", "schedule"], correct: 0 },
{ swedish: "ruta", english: ["box, square", "circle", "triangle", "line"], correct: 0 },
{ swedish: "att verka", english: ["to seem", "to be", "to ignore", "to avoid"], correct: 0 },
{ swedish: "ledig, ledigt", english: ["free, available", "occupied", "busy", "reserved"], correct: 0 },
{ swedish: "ligga (i centrum)", english: ["be (located in the centre)", "to stand", "to walk", "to leave"], correct: 0 },
{ swedish: "centralt", english: ["in the centre", "outskirts", "border", "side"], correct: 0 },
{ swedish: "Stortorget", english: ["main square in Lund", "park", "garden", "station"], correct: 0 },
{ swedish: "att ingå", english: ["to be included", "to be excluded", "to be removed", "to be ignored"], correct: 0 },
{ swedish: "väl", english: ["well", "poorly", "badly", "inadequately"], correct: 0 },
{ swedish: "den börjar serveras", english: ["it is served from", "it ends", "it is removed", "it stops"], correct: 0 },
{ swedish: "Hur är det med...?", english: ["What about...?", "How is...?", "Where is...?", "When is...?"], correct: 0 },
{ swedish: "all, allt", english: ["all", "none", "some", "few"], correct: 0 },
{ swedish: "rum", english: ["room", "hall", "closet", "building"], correct: 0 },
{ swedish: "slippa ifrån", english: ["to escape, to avoid", "to face", "to meet", "to confront"], correct: 0 },
{ swedish: "dumburk", english: ["goggle box", "computer", "smartphone", "tablet"], correct: 0 },
{ swedish: "i alla fall", english: ["anyway", "never", "seldom", "perhaps"], correct: 0 },
{ swedish: "öronpropp", english: ["earplug", "headphone", "earphone", "speaker"], correct: 0 },
{ swedish: "Knut den Store", english: ["King Canute", "King Arthur", "Emperor Charles", "Prince Henry"], correct: 0 },
{ swedish: "att grunda", english: ["to found", "to destroy", "to lose", "to demolish"], correct: 0 },
{ swedish: "biskopssäte", english: ["bishopric, cathedral city", "monastery", "cathedral", "abbey"], correct: 0 },
{ swedish: "bl.a. (bland annat)", english: ["inter alia", "in particular", "only", "overall"], correct: 0 },
{ swedish: "ur", english: ["clock", "watch", "bell", "hour"], correct: 0 },
{ swedish: "besökare", english: ["visitor", "resident", "host", "guide"], correct: 0 },
{ swedish: "t.ex. (till exempel)", english: ["for example", "in general", "instead", "however"], correct: 0 },
{ swedish: "hit", english: ["here", "there", "everywhere", "nowhere"], correct: 0 },
{ swedish: "att slå", english: ["to strike", "to miss", "to catch", "to throw"], correct: 0 },
{ swedish: "riddare", english: ["knight", "soldier", "warrior", "prince"], correct: 0 },
{ swedish: "konst", english: ["art", "science", "craft", "music"], correct: 0 },
{ swedish: "trädgård", english: ["garden", "forest", "park", "field"], correct: 0 },
{ swedish: "friluftsmuseum", english: ["open-air museum", "indoor museum", "gallery", "exhibition"], correct: 0 },
{ swedish: "samling", english: ["collection", "division", "separation", "loss"], correct: 0 },
{ swedish: "byggnad", english: ["building", "house", "road", "bridge"], correct: 0 },
{ swedish: "bondstuga", english: ["peasant cottage", "mansion", "palace", "villa"], correct: 0 },
{ swedish: "landsbygd", english: ["countryside", "city", "suburb", "village"], correct: 0 },
{ swedish: "t.o.m. (till och med)", english: ["even", "until", "through", "besides"], correct: 0 },
{ swedish: "träkyrka", english: ["timber church", "stone castle", "wooden house", "chapel"], correct: 0 },

        ];
		
        let isRetry = false;

        // New Variables for Progress Tracking
        let totalQuestions = 0;
        let answeredQuestions = 0;
        let currentCorrectIndex = 0;

        // Function to shuffle an array (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to render the missed words list in the DOM
        function renderMissedWordsList() {
            const missedList = document.getElementById("missed-words-list");
            missedList.innerHTML = ""; // Clear existing list

            missedWords.forEach(word => {
                const missedWordItem = document.createElement("li");
                missedWordItem.innerText = word.swedish;
                missedList.appendChild(missedWordItem);
            });
        }

        // Start a new set of questions
        function startNewSet() {
            missedWords = []; // Reset missed words for the new round
            renderMissedWordsList(); // Clear or update UI list based on missedWords

            const wordList = isRetry ? previousRoundMissedWords : vocabulary;
            totalQuestions = wordList.length;
            answeredQuestions = 0;
            document.getElementById("progress").style.width = "0%";

            if (!isRetry) {
                correctAnswers = 0;
                mistakes = 0;
                document.getElementById("correct-counter").innerText = "0";
                document.getElementById("mistake-counter").innerText = "0";
            }
        }

        // Load a question
        function loadQuestion() {
            const wordList = isRetry ? previousRoundMissedWords : vocabulary;

            if (currentQuestion >= wordList.length) {
                if (missedWords.length === 0) {
                    document.getElementById("feedback").innerText = "You've completed the quiz!";
                    isRetry = false;
                    document.getElementById("missedModal").style.display = "none";
                } else {
                    showModal();
                }
                return;
            }

            const currentWord = wordList[currentQuestion];
            document.getElementById("swedish-word").innerText = currentWord.swedish;

            let shuffledChoices = [...currentWord.english];
            shuffledChoices = shuffleArray(shuffledChoices);

            const correctAnswerText = currentWord.english[currentWord.correct];
            currentCorrectIndex = shuffledChoices.indexOf(correctAnswerText);

            for (let i = 0; i < 4; i++) {
                document.getElementById(`choice${i}`).innerText = shuffledChoices[i];
            }

            document.getElementById("feedback").innerText = "";
        }

        // Speak the Swedish word
        function speakSwedish() {
            const wordList = isRetry ? previousRoundMissedWords : vocabulary;
            if (currentQuestion >= wordList.length) {
                return;
            }
            const swedishWord = wordList[currentQuestion].swedish;
            responsiveVoice.speak(swedishWord, 'Swedish Female');
        }

        // Update the progress bar
        function updateProgressBar() {
            if (totalQuestions === 0) return;
            const progress = (answeredQuestions / totalQuestions) * 100;
            document.getElementById("progress").style.width = `${progress}%`;
        }

        // Check the user's answer
        function checkAnswer(choice) {
            const wordList = isRetry ? previousRoundMissedWords : vocabulary;

            if (currentQuestion >= wordList.length) {
                return;
            }

            const currentWord = wordList[currentQuestion];
            const isCorrect = choice === currentCorrectIndex;

            if (isCorrect) {
                document.getElementById("feedback").innerText = "Correct!";
                correctAnswers++;
                document.getElementById("correct-counter").innerText = correctAnswers;

                // Remove word from missedWords if answered correctly in retry
                if (isRetry) {
                    missedWords = missedWords.filter(word => word.swedish !== currentWord.swedish);
                    renderMissedWordsList();
                }

                answeredQuestions++;
                updateProgressBar();
            } else {
                document.getElementById("feedback").innerText = "Wrong answer!";
                mistakes++;
                document.getElementById("mistake-counter").innerText = mistakes;

                // Add to missedWords for the current round
                if (!missedWords.some(word => word.swedish === currentWord.swedish)) {
                    missedWords.push(currentWord);
                    renderMissedWordsList();
                }

                answeredQuestions++;
                updateProgressBar();
            }

            currentQuestion++;
            setTimeout(() => {
                loadQuestion();
            }, 500);
        }

        // Show the modal if there are missed words
        function showModal() {
            const modalMessage = document.getElementById("modal-message");
            if (missedWords.length === 1) {
                modalMessage.innerHTML = `You got "${missedWords[0].swedish}" wrong. Do you want to try it again?`;
            } else if (missedWords.length > 1) {
                modalMessage.innerHTML = `You made ${mistakes} mistake${mistakes > 1 ? 's' : ''}. Do you want to try those words again?`;
            }
            document.getElementById("missedModal").style.display = "flex";
        }

// Close the modal
function closeModal() {
    document.getElementById("missedModal").style.display = "none";
    
    // Clear the missed words list when the modal closes
    missedWords = [];
    renderMissedWordsList(); // Update the UI to reflect the cleared list
}

        // Retry with missed words
        function retryMissed() {
            if (missedWords.length === 0) {
                document.getElementById("feedback").innerText = "Great job! No words to retry.";
                closeModal();
                return;
            }

            previousRoundMissedWords = [...missedWords]; // Store missed words for this retry round
            missedWords = []; // Clear missedWords for the new retry round

            isRetry = true;

            currentQuestion = 0;
            correctAnswers = 0;
            mistakes = 0;
            document.getElementById("correct-counter").innerText = correctAnswers;
            document.getElementById("mistake-counter").innerText = mistakes;

            answeredQuestions = 0;
            totalQuestions = previousRoundMissedWords.length;
            document.getElementById("progress").style.width = "0%";

            closeModal();
            loadQuestion();
        }

        // Reset the quiz by refreshing the page
        function resetPage() {
            location.reload();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            const modeLabel = document.getElementById("modeLabel");
            modeLabel.innerText = document.body.classList.contains("dark-mode") ? "Dark mode" : "Dark mode";
        }

        // Initialize the quiz
        window.onload = function() {
            document.getElementById("missedModal").style.display = "none";
            startNewSet();
            loadQuestion();
        };
    </script>
</body>
</html>
